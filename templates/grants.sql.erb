# Generated by Chef for <%= node["fqdn"] %>.
# Local modifications will be overwritten.

<% if node["percona"]["backup"]["configure"] %>
# Grant permissions for the XtraBackup user
# Ensure the user exists, then revoke all grants, then re-grant specific permissions
CREATE USER IF NOT EXISTS '<%= node["percona"]["backup"]["username"] %>'@'localhost' IDENTIFIED BY '<%= @backup_password %>';
GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO '<%= node["percona"]["backup"]["username"] %>'@'localhost';
REVOKE ALL PRIVILEGES, GRANT OPTION FROM '<%= node["percona"]["backup"]["username"] %>'@'localhost';
GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO '<%= node["percona"]["backup"]["username"] %>'@'localhost';
<% end -%>

# Set the server root password. This should be preseeded by the package installation.
ALTER USER 'root'@'localhost' IDENTIFIED BY '<%= @root_password %>';

FLUSH PRIVILEGES;
